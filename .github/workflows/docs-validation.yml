# Docs validation pipeline for signal-fish-client
#
# Runs on every push to main and on all pull requests that touch
# markdown files, documentation config, or this workflow itself.
# Jobs: markdownlint, link-check, spell-check
#
# Cancel in-progress runs on the same branch to save resources.

name: Docs Validation

on:
  push:
    branches: [main]
    paths:
      - "**/*.md"
      - "docs/**"
      - ".markdownlint.json"
      - ".markdownlint-cli2.jsonc"
      - ".lychee.toml"
      - ".typos.toml"
      - "mkdocs.yml"
      - ".github/workflows/docs-validation.yml"
  pull_request:
    paths:
      - "**/*.md"
      - "docs/**"
      - ".markdownlint.json"
      - ".markdownlint-cli2.jsonc"
      - ".lychee.toml"
      - ".typos.toml"
      - "mkdocs.yml"
      - ".github/workflows/docs-validation.yml"

permissions:
  contents: read

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # ──────────────────────────────────────────────────────────────
  # Markdownlint — lint markdown files for style consistency
  # ──────────────────────────────────────────────────────────────
  markdownlint:
    name: Markdownlint
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Checkout repository
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd  # v6.0.2

      - name: Run markdownlint
        uses: DavidAnson/markdownlint-cli2-action@07035fd053f7be764496c0f8d8f9f41f98305101  # v22
        with:
          globs: |
            **/*.md

  # ──────────────────────────────────────────────────────────────
  # Link check — verify all URLs in markdown files resolve
  # ──────────────────────────────────────────────────────────────
  link-check:
    name: Link Check
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: Checkout repository
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd  # v6.0.2

      - name: Run lychee link checker
        uses: lycheeverse/lychee-action@a8c4c7cb88f0c7386610c35eb25108e448569cb0  # v2
        with:
          args: >-
            --config .lychee.toml
            "**/*.md"
          fail: true

  # ──────────────────────────────────────────────────────────────
  # Spell check — catch typos in source and documentation
  # Note: typos scans all project files (not just markdown) which
  # also catches typos in Rust source, TOML configs, YAML, etc.
  # ──────────────────────────────────────────────────────────────
  spell-check:
    name: Spell Check
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - name: Checkout repository
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd  # v6.0.2

      - name: Run typos spell checker
        uses: crate-ci/typos@57b11c6b7e54c402ccd9cda953f1072ec4f78e33  # v1
        with:
          config: .typos.toml
